<!-- Polymer dependencies -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">

<link rel="import" href="../../web-components/project-nice-article-item/project-nice-article-item.html">
<link rel="import" href="../../web-components/project-nice-article-view/project-nice-article-view.html">
<link rel="import" href="../../web-components/project-nice-article-form/project-nice-article-form.html">
<link rel="import" href="../../web-components/project-nice-article/project-nice-article-behavior.html">

<!-- Style dependency -->
<link rel="import" href="article-page-style.html">

<dom-module id="article-page">
  <template>
    <style is="custom-style" include="article-page-style iron-flex iron-flex-alignment iron-flex-factors">
      :host {
        display: block;
      }
    </style>

    <template is="dom-if" if="[[!id]]">
      <firebase-query
          path="[[articlePath.list.published]]"
          data="{{articles}}"></firebase-query>

      <div class="padder">
        <div class="horizontal layout wrap">
          <div class="flex-5 main-content">
            <h1 class="">Photoblog</h1>
            <h1 class="">News</h1>
            <h1 class="">Articles</h1>

            <template is="dom-repeat" items="[[articles]]">
              <project-nice-article-item id="[[item.$key]]" date-published="[[item.date]]"></project-nice-article-item>          
            </template>
          </div>
          <div class="flex-2">
            <h1 class="">Trending</h1>
          </div>
        </div>   
      </div>
      
      <a href="#" id="new-article" class="new-button" on-tap="_addArticle">
        <paper-fab icon="default:add"></paper-fab>
      </a>
    </template>
    
    <template is="dom-if" if="[[id]]">
      <firebase-document 
          path="[[articlePath.articles]]/[[id]]"
          data="{{article}}"></firebase-document>

      <firebase-document
          path="[[articlePath.list.published]]/[[id]]"
          data="{{articlePublished}}"></firebase-document>

      <firebase-query
          path="[[articlePath.storage.images]]/[[id]]"
          data="{{images}}"></firebase-query>

      <firebase-query
          path="[[articlePath.storage.documents]]/[[id]]"
          data="{{documents}}"></firebase-query>

      <template is="dom-if" if="[[_forceZero(article)]]">
        <!-- _checkPublished(articlePublished.published, user) -->
        <template is="dom-if" if="[[user]]">
          <div class="horizontal layout wrap">
            <template is="dom-if" if="[[edit]]">
              <!-- Article-form -->
              <project-nice-article-form
                  category
                  type
                  article-id="[[id]]"                  
                  path="[[articlePath.articles]]/[[id]]"
                  class="flex"
                  title="{{article.title}}"
                  sub-title="{{article.subTitle}}"
                  banner-image="{{article.bannerImage}}"
                  banner-image-storage-path="[[articlePath.storage.bannerImage]]/[[id]]"
                  body="{{article.body}}"
                  images-storage-path="[[articlePath.storage.images]]/[[id]]"
                  documents-storage-path="[[articlePath.storage.documents]]/[[id]]"
                  video="{{article.video}}"
                  list-path="[[articlePath.listOptions]]"
                  published-path="[[articlePath.list.published]]/[[id]]"
                  draft-path="[[articlePath.list.draft]]/[[id]]"
                  categories="[[article.categories]]"
                  types="[[article.types]]"
                  url="/article/[[id]]"></project-nice-article-form>
            </template>

            <!-- Article-view -->
            <project-nice-article-view
                category
                type
                class="flex"
                title="[[article.title]]"
                sub-title="[[article.subTitle]]"
                banner-image="[[article.bannerImage]]"
                body="[[article.body]]"
                images="[[images]]"
                documents="[[documents]]"
                video="[[article.video]]"
                categories="[[article.categories]]"
                types="[[article.types]]"
                user="[[user]]"
                url="/article/[[id]]"
                edit="[[edit]]"></project-nice-article-view>
            
          </div>
        </template>
        
        
      </template>

      <template is="dom-if" if="[[!_forceZero(article)]]">
        Loading
      </template>
    </template>

  </template>

  <script>
    Polymer({
      is: 'article-page',

      behaviors: [
        NICEV1.ProjectNiceArticleBehavior
      ],

      properties: {
        params: {
          type: Object
        },
        id: {
          type: String,
          value: ''
        },
        edit: {
          type: Boolean
        }
      },

      observers: [
        '_changeParamsId(params.id)',
        '_changeQuaryParamsEdit(queryParams.edit)',
      ],

      _changeParamsId: function(e) {
        this.id = e || ''
      },

      _changeQuaryParamsEdit: function(e) {
        this.edit = e === 'true';
      },

      _checkPublished: function(published, user) {
        return published || user;
      }
    });
  </script>
</dom-module>
